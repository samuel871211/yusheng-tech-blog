---
title: HTTP Live Streaming è·Ÿ m3u8 æ˜¯ä»€éº¼ï¼Ÿä¸€ç¯‡å¸¶ä½ ææ‡‚
description: HTTP Live Streaming è·Ÿ m3u8 æ˜¯ä»€éº¼ï¼Ÿä¸€ç¯‡å¸¶ä½ ææ‡‚
last_update:
  date: "2026-01-06T08:00:00+08:00"
---

## å‰è¨€

æŸå¤©åœ¨ [è¯åˆå½±éŸ³ç¶²](https://video.udn.com/) çœ‹åˆ°äº†å½±ç‰‡çš„ HTML æ¨™ç±¤

```html
<video
  class="ui-video"
  width="100%"
  height="100%"
  preload="metadata"
  playsinline=""
  webkit-playsinline=""
  muted=""
  src="https://cdn.udn.com/vods3/251221183729786/playlist.m3u8?Expires=1766662347&amp;Signature=ZWqGVYw0N2OmZwdV3H1K0PKHueIlAaqBTOnyVLLyx2jci--wJlhEFPWZACRz7tyWjAoS9HXfcnp4slgccKPHgyY0ALZoELt9wbh6v8OeRsescv-g92VQI4LCGLfDiZOFWLvzST517VeEEf-r41Thv3TDrQyHZ7964flGaTkjw~A_&amp;Key-Pair-Id=APKAJRQ6UOZB4E3SGXWQ"
>
  <track
    src="//video.udn.com/api-player/video-subtitle/news/1316728"
    default="true"
  />
</video>
```

å…¶ä¸­ `preload="metadata"`ã€`.m3u8` è·Ÿ `<track>` éƒ½æ˜¯æˆ‘æ²’çœ‹éçš„ï¼Œå°±è¶é€™å€‹æ©Ÿæœƒä¾†ç ”ç©¶çœ‹çœ‹å§ï¼

## HTMLMediaElement: preload

Syntax

```html
<video preload="none"></video>
<video preload="metadata"></video>
<video preload="auto"></video>
```

### preload="none"

é€™å€‹æ‡‰è©²æ²’æœ‰çˆ­è­°ï¼Œå°±æ˜¯ media é–‹å§‹æ’­æ”¾ï¼Œæ‰æœƒç™¼èµ· HTTP Request è¼‰å…¥è³‡æº

### preload="auto"

å‘Šè¨´ç€è¦½å™¨ "å¯ä»¥ä¸‹è¼‰æ•´å€‹è³‡æºï¼Œå³ä¾¿ä½¿ç”¨è€…é‚„æ²’æŒ‰æ’­æ”¾"

é€™é‚Šè¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒç€è¦½å™¨çš„å¯¦ä½œæ–¹å¼ä¸åŒï¼Œæˆ‘ä»¥ Chrome ç€è¦½å™¨ç‚ºä¾‹

```html
<video
  muted
  controls
  playsinline
  preload="auto"
  width="100%"
  height="100%"
  src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4"
></video>
```

ä¸€é–‹å§‹åªæœƒå…ˆä¸‹è¼‰å¹¾ MB çš„è³‡æ–™

![preload-auto-chrome-1.5s](../../static/img/preload-auto-chrome-1.5s.jpg)

ä¹‹å¾Œä½¿ç”¨è€…é–‹å§‹æ’­æ”¾å½±ç‰‡å¾Œï¼Œæœƒç”¨åŒä¸€å€‹é€£ç·šæ¥æ”¶å¾ŒçºŒçš„è³‡æº

![preload-auto-chrome-keep-connection](../../static/img/preload-auto-chrome-keep-connection.jpg)

åœ¨è³‡æºå®Œæ•´æ¥æ”¶å®Œä¹‹å‰ï¼Œéƒ½æœƒé¡¯ç¤º `CAUTION: request is not finished yet!`

:::warning
ä¸Šè¿°æƒ…å¢ƒï¼Œåƒ…é™æ–¼æ²’æœ‰è·³è½‰å½±ç‰‡çš„æƒ…æ³

è‹¥æœ‰è·³è½‰ï¼Œå‰‡æœƒç™¼èµ·æ–°çš„ [Range Request](./http-range-requests.md)
:::

ç¸½çµä¾†èªªï¼Œ`preload="auto"` ä¸¦æ²’æœ‰å¼·åˆ¶ç€è¦½å™¨è¦é¦¬ä¸Š "ä¸‹è¼‰æ•´å€‹è³‡æº"

### preload="metadata"

æˆ‘å¾ˆå¥½å¥‡æ‰€è¬‚çš„ metadata æœ‰å“ªäº›

æˆ‘ç¬¬ä¸€å€‹æƒ³åˆ°çš„æ˜¯ `firebase/storage` æœ‰ `getMetadata` é€™å€‹æ–¹æ³•ï¼Œé †æ‰‹å¯¦æ¸¬çœ‹çœ‹

```ts
const firebaseOptions: FirebaseOptions = {
  apiKey: process.env.apiKey,
  authDomain: process.env.authDomain,
  databaseURL: process.env.databaseURL,
  projectId: process.env.projectId,
  storageBucket: process.env.storageBucket,
  messagingSenderId: process.env.messagingSenderId,
  appId: process.env.appId,
  measurementId: process.env.measurementId,
};
const firebaseApp = initializeApp(firebaseOptions);
const firebaseStorage = getStorage(firebaseApp);
const storageRef = ref(firebaseStorage, "20230519/20230519_123754.jpg");
getMetadata(storageRef).then(console.log);
```

çµæœ

```json
{
  "type": "file",
  "bucket": "xxxx-xxxxxx-xx.appspot.com",
  "generation": "1726576002013836",
  "metageneration": "4",
  "fullPath": "20230519/20230519_123754.jpg",
  "name": "20230519_123754.jpg",
  "size": 4312957,
  "timeCreated": "2024-09-17T12:26:42.015Z",
  "updated": "2024-11-13T12:35:07.690Z",
  "md5Hash": "wkMu9YKP/eCW/BCsvgfRkg==",
  "contentEncoding": "identity",
  "contentLanguage": "en",
  "contentType": "image/jpeg"
}
```

metadata çš„ä¸­æ–‡å¾ˆé›£è§£é‡‹ï¼Œå¦‚æœä»¥ä¸Šè¿°ä¾‹å­ä¾†çœ‹ï¼Œå°±æ˜¯ "æè¿°é€™å¼µåœ–ç‰‡" çš„è³‡æ–™

æœ‰äº† metadata çš„æ¦‚å¿µï¼Œæˆ‘å€‘æ¥è‘—ä¾†å¯¦æ¸¬ `preload="metadata"` åˆ°åº•åŒ…å«å“ªäº›å±¬æ€§

åŸºæœ¬çš„ HTML

```html
<video
  preload="metadata"
  width="100%"
  height="100%"
  src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4"
></video>
```

å¯«å€‹ JS å°å‡º onloadedmetadata å‰å¾Œçš„ HTMLVideoElement å·®ç•°

```html
<script>
  const videoEl = document.getElementsByTagName("video")[0];
  const oldVideoEl = {};
  for (const attr in videoEl) {
    oldVideoEl[attr] = videoEl[attr];
  }
  console.log(oldVideoEl);
  videoEl.addEventListener("loadedmetadata", (e) => {
    const newVideoEl = {};
    for (const attr in videoEl) {
      newVideoEl[attr] = videoEl[attr];
    }
    console.log(newVideoEl);
  });
</script>
```

ä½¿ç”¨ git æ¯”è¼ƒ `oldVideoEl` è·Ÿ `newVideoEl` çš„å·®ç•°
![video-preload-attrs](../../static/img/video-preload-attrs.jpg)

å¯ä»¥å¾—çŸ¥ä»¥ä¸‹å°±æ˜¯ video çš„ metadata

```json
{
  "videoWidth": 1280,
  "videoHeight": 720,
  "duration": 653.804263
}
```

å¯¦éš›ä¸Šè§€å¯Ÿç€è¦½å™¨çš„ Networkï¼Œç€è¦½å™¨åªæœƒå…ˆè¼‰å…¥éƒ¨åˆ† mp4 çš„å…§å®¹ï¼Œä¸”è¼‰å…¥çš„è³‡æ–™é‡æ˜é¡¯æ¯” `preload="auto"` é‚„è¦å°‘

![preload-metadata-not-load-all-content](../../static/img/preload-metadata-not-load-all-content.jpg)

å¦å¤–æˆ‘ä¹Ÿç™¼ç¾ä¸€å€‹è »æœ‰è¶£çš„ï¼Œè‹¥ Server ä¸æ”¯æ´ [Range Request](./http-range-requests.md)ï¼Œç›´æ¥å›å‚³ 200 + æ•´å€‹ MP4 æª”æ¡ˆ

```ts
import { readFileSync } from "fs";
import httpServer from "../httpServer";
import { join } from "path";

httpServer.on("request", function requestListener(req, res) {
  const url = new URL(req.url || "/", "http://localhost:5000");
  if (url.pathname === "/ElephantsDream.mp4") {
    const filePath = join(__dirname, "../range/ElephantsDream.mp4");
    const nonSharedBuffer = readFileSync(filePath);
    res.setHeader("Content-Type", "video/mp4");
    res.end(nonSharedBuffer);
    return;
  }
});
```

åœ¨ Chrome ç€è¦½å™¨æœƒå…ˆé¡¯ç¤º `CAUTION: request is not finished yet!`

![CAUTION: request is not finished yet!](../../static/img/request-is-not-finished-yet.jpg)

é€™æ™‚å€™å·²ç¶“è§¸ç™¼ loadedmetadata äº‹ä»¶äº†ï¼

ç­‰åˆ°æ•´éƒ¨ mp4 å½±ç‰‡çš„ Response Body å‚³è¼¸å®Œç•¢å¾Œï¼Œè­¦å‘Šè¨Šæ¯å°±æœƒæ¶ˆå¤±

![video-request-content-download-23s](../../static/img/video-request-content-download-23s.jpg)

åä¹‹ï¼Œè‹¥ Server æœ‰æ”¯æ´ Range Requestï¼ˆå…¶å¯¦ä¹Ÿä¸ç”¨çœŸçš„æ”¯æ´ï¼Œåªè¦å›å‚³ä»¥ä¸‹ Header æ¬ºé¨™ç€è¦½å™¨å³å¯ï¼‰

```ts
res.setHeader("Accept-Ranges", "bytes");
```

å°±ä¸æœƒæœ‰ä¸Šè¿°çš„è­¦å‘Šè¨Šæ¯ï¼Œå¾ Content Download çš„æ™‚é–“ä¾†çœ‹ï¼Œæ‡‰è©²ä¹Ÿæ˜¯ç€è¦½å™¨è§£æå®Œ mp4 metadata å¾Œï¼Œå°±ç›´æ¥é—œé–‰é€£ç·š

![accept-ranges-video-preload-metadata](../../static/img/accept-ranges-video-preload-metadata.jpg)

ğŸ§ è‡³æ–¼ç‚ºä½• `Accept-Ranges: bytes` æœƒå½±éŸ¿ç€è¦½å™¨ "æ˜¯å¦è¦ä¸‹è¼‰æ•´å€‹æª”æ¡ˆ" å‘¢ï¼Ÿ

è‹¥å¾ç€è¦½å™¨ (Client) çš„è§’åº¦æ€è€ƒ:

æ²’æœ‰ Accept-Ranges:

- ğŸ’­ Server ä¸æ”¯æ´ Range Request
- ğŸ’­ é€™æ¬¡é€£ç·šæ˜¯å”¯ä¸€æ‹¿è³‡æ–™çš„æ©Ÿæœƒ
- ğŸ’­ å¦‚æœæˆ‘ç¾åœ¨é—œæ‰ï¼Œå°±æ°¸é æ‹¿ä¸åˆ°å‰©ä¸‹çš„è³‡æ–™äº†

æœ‰ Accept-Ranges:

- ğŸ’­ å¤ªå¥½äº†ï¼Server æ”¯æ´ Range Request
- ğŸ’­ æˆ‘ç¾åœ¨åªè¦ metadataï¼Œæ‹¿å®Œå°±å¯ä»¥å…ˆé—œé–‰é€£ç·š
- ğŸ’­ ä¹‹å¾Œéš¨æ™‚å¯ä»¥ç”¨ Range Request å†è¦è³‡æ–™

## `<track>`

å†ä¾†è«‡åˆ° `<track>`ï¼Œå¯ä»¥å¹«å½±ç‰‡æˆ–éŸ³æ¨‚åŠ ä¸Šå­—å¹•ï¼Œå…·é«”ä½¿ç”¨æ–¹æ³•ç‚º

```html
<video src="video.mp4">
  <track default srclang="en" label="English" src="subtitle-en.vtt" />
  <track srclang="zh-TW" label="ç¹é«”ä¸­æ–‡" src="subtitle-zh-TW.vtt" />
</video>
```

æ ¹æ“š [HTMLMediaElement: loadedmetadata](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/loadedmetadata_event) çš„æè¿°ï¼Œå­—å¹•ä¹Ÿåœ¨ `preload="metadata"` çš„ç¯„åœå…§

æˆ‘å€‘å˜—è©¦çœ‹çœ‹

NodeJS http server

```ts
if (url.pathname === "/") {
  res.setHeader("Content-Type", "text/html");
  res.end(readFileSync(join(__dirname, "index.html")));
  return;
}
if (url.pathname === "/copy-from-mdn.vtt") {
  const filePath = join(__dirname, "copy-from-mdn.vtt");
  const nonSharedBuffer = readFileSync(filePath);
  res.setHeader("Content-Type", "text/vtt");
  res.end(nonSharedBuffer);
  return;
}
if (url.pathname === "/ElephantsDream.mp4") {
  const filePath = join(__dirname, "../range/ElephantsDream.mp4");
  const nonSharedBuffer = readFileSync(filePath);
  res.setHeader("Content-Type", "video/mp4");
  res.end(nonSharedBuffer);
  return;
}
```

HTML çš„éƒ¨åˆ†

```html
<video
  muted
  controls
  playsinline
  preload="metadata"
  width="100%"
  height="100%"
  src="ElephantsDream.mp4"
>
  <track default srclang="en" label="English" src="copy-from-mdn.vtt" />
</video>
```

å¯¦æ¸¬ç¢ºå¯¦æœƒé å…ˆè¼‰å…¥å­—å¹•ï½
![preload-metadata-include-vtt](../../static/img/preload-metadata-include-vtt.jpg)

## vtt

vtt å…¨åæ˜¯ Web Video Text Tracks Format (WEBVTT)ï¼Œæ˜¯ä¸€å€‹ç´”æ–‡æœ¬çš„æ ¼å¼

![webvtt-pure-text](../../static/img/webvtt-pure-text.jpg)

ç´°ç¯€çš„éƒ¨åˆ†ï¼Œæœ¬ç¯‡ä¸æœƒè¨è«–ï¼Œå› ç‚ºæˆ‘è¦ºå¾—è·Ÿ http å”è­°æ²’ä»€éº¼é—œè¯ (?)

## srt

èªªåˆ°å­—å¹•ï¼Œæˆ‘ç¬¬ä¸€å€‹æƒ³åˆ°çš„æ˜¯ srtï¼Œä¹Ÿæ˜¯ç´”æ–‡æœ¬çš„æ ¼å¼

```
1
00:00:01,000 --> 00:00:04,000
é€™æ˜¯ç¬¬ä¸€è¡Œå­—å¹•ã€‚

2
00:00:05,000 --> 00:00:7,000
é€™æ˜¯ç¬¬äºŒè¡Œå­—å¹•ã€‚

3
00:00:8,000 --> 00:00:10,000
é€™æ˜¯ç¬¬ä¸‰è¡Œå­—å¹•ã€‚
```

## m3u8 ç°¡ä»‹

- å‰èº«æ˜¯ MP3 URL (m3u)
- é€™æ˜¯ä¸€å€‹ç´”æ–‡æœ¬çš„å…§å®¹
- å¯ä»¥åˆ—å‡ºéŸ³æ¨‚æˆ–å½±ç‰‡çš„æ‰€åœ¨ä½ç½®
- ä¸»è¦ä½œç”¨æ˜¯ï¼Œåª’é«”æ’­æ”¾å™¨çŸ¥é“è¦æ’­æ”¾å“ªäº›æª”æ¡ˆ
- m3u å·²ç¶“å¾ˆå°‘ä½¿ç”¨äº†ï¼Œç¾åœ¨åŸºæœ¬ä¸Šéƒ½æ˜¯ç”¨ m3u8
- m3u8 çš„ 8 æ˜¯æŒ‡ UTF-8
- [RFC 8216: HTTP Live Streaming](https://datatracker.ietf.org/doc/html/rfc8216) è·Ÿ m3u8 çš„é—œä¿‚å¯†ä¸å¯åˆ†
- æ ¸å¿ƒæ¦‚å¿µ: å°‡ä¸åŒç•«è³ªçš„å½±ç‰‡åˆ‡åˆ†æˆå¤šæ®µå½±ç‰‡ï¼Œæ–¹ä¾¿å¿«å–ã€åœ¨ç¶²é€Ÿæ³¢å‹•çš„æƒ…æ³å‹•æ…‹èª¿æ•´ç•«è³ª
- RFC 8216 æ˜¯è˜‹æœæå‡ºçš„ï¼ˆæ¨æ¸¬æ˜¯ç‚ºäº†è§£æ±º iPhone æ‰‹æ©Ÿåœ¨ç¶²è·¯ä¸ç©©çš„æƒ…æ³è½éŸ³æ¨‚ã€çœ‹å½±ç‰‡ï¼Œåˆè¦ä¿æŒæœ€ä½³çš„ä½¿ç”¨è€…é«”é©—ï¼‰
- Content-Type: application/vnd.apple.mpegurl

## è§€å¯Ÿ `<video>` + m3u8 æ˜¯å¦‚ä½•è¼‰å…¥å½±ç‰‡

æˆ‘å€‘ä»¥ https://cdn.udn.com/vods3/251221183729786/playlist.m3u8 ç‚ºç¯„ä¾‹

1. é¦–å…ˆï¼Œç€è¦½å™¨æœƒè¼‰å…¥ playlist.m3u8
   ![m3u8-apply-diff-resolution](../../static/img/m3u8-apply-diff-resolution.jpg)

2. æ¥è‘—ï¼Œç€è¦½å™¨æœƒæœ‰ä¸€å¥—é»‘ç®±çš„æ©Ÿåˆ¶ï¼Œé¸æ“‡å‡ºå°æ‡‰ç•«è³ªçš„ chunklist.m3u8
   ![browser-choose-1920-chunklist](../../static/img/browser-choose-1920-chunklist.jpg)

3. æœ€å¾Œï¼Œå°±æœƒæ ¹æ“š chunklist.m3u8 çš„å…§å®¹ï¼Œè¼‰å…¥å°æ‡‰çš„ ts å½±ç‰‡
   ![browser-load-ts-chunks](../../static/img/browser-load-ts-chunks.jpg)

## m3u8 vs HTTP Range Request

å‡è¨­ä»Šå¤©ä½ æ”¶åˆ°ä¸€å€‹éœ€æ±‚ï¼Œè¦åœ¨ç¶²é ä¸Šå‘ˆç¾ä¸€å€‹ 10 åˆ†é˜çš„å½±ç‰‡ï¼Œä¸¦ä¸”è¦ç¢ºä¿è·¨è£ç½®çš„ç”¨æˆ¶éƒ½èƒ½ç²å¾—æœ€å¥½çš„ä½¿ç”¨è€…é«”é©—

ç¸½å…±æœ‰ä¸‰å€‹å½±ç‰‡ç´ æ

- video_480P.mp4
- video_720P.mp4
- video_1080P.mp4

ä½ å¾ˆé–‹å¿ƒçš„å¯«äº†ä¸€ç‰ˆ HTMLï¼Œæ ¹æ“šä½¿ç”¨è€…çš„è£ç½®å¯¬åº¦ï¼Œä¾†æ±ºå®šè¦è¼‰å…¥å“ªå€‹ç•«è³ªçš„å½±ç‰‡

```html
<video src="video_480P.mp4" v-if="width <= 600"></video>
<video src="video_720P.mp4" v-if="width > 600 && width <= 1024"></video>
<video src="video_1080P.mp4" v-if="width > 1024"></video>
```

çµæœç™¼ç¾ç”¨æ‰‹æ©Ÿè§€çœ‹ç•«è³ªè¶…çˆ›...

æ¥è‘—ä½ é–‹å§‹ç ”ç©¶

- [navigator.connection.effectiveType](https://developer.mozilla.org/en-US/docs/Web/API/NetworkInformation/effectiveType)
- [navigator.mediaCapabilities](https://developer.mozilla.org/en-US/docs/Web/API/Media_Capabilities_API)
- [navigator.deviceMemory](https://developer.mozilla.org/en-US/docs/Web/API/Navigator/deviceMemory)

ä½†ä½ ç™¼ç¾ï¼Œæœ€çµ‚ä¹Ÿåªèƒ½æ±ºå®š "åˆå§‹è¼‰å…¥çš„å½±ç‰‡ç•«è³ª"ï¼Œå¦‚æœä»Šå¤©åœ¨ç§»å‹•çš„ç«è»Šä¸Šï¼Œæˆ–æ˜¯å‰›å¥½æ­é›»æ¢¯ï¼Œéƒ½æœƒé‡åˆ°ç¶²è·¯ä¸ç©©å®šçš„ç‹€æ³

ç‚ºä»€éº¼æˆ‘å€‘å¹³å¸¸çœ‹å½±ç‰‡çš„å¹³å°ï¼ˆYouTube, Netfilx...ï¼‰éƒ½å¯ä»¥åšåˆ°å‹•æ…‹åˆ‡æ›ç•«è³ªå‘¢ï¼Ÿå…¶ä¸­ä¸€å€‹åŸå› å°±æ˜¯ m3u8ï¼

ç›´æ¥ä¾†å¼µåœ–æ¯”è¼ƒ m3u8 è·Ÿå‚³çµ± HTTP Range Request + å¤§å‹ mp4 æª”æ¡ˆçš„å·®åˆ¥
![m3u8-vs-http-range-request](../../static/m3u8-vs-http-range-request.svg)

å¦å¤–ï¼Œç”±æ–¼ m3u8 æ˜¯ Server æ±ºå®šè¦æŠŠå½±ç‰‡åˆ‡æˆå¹¾ç­‰ä»½ï¼Œæ‰€ä»¥æª”åæ˜¯å›ºå®šçš„ï¼Œéå¸¸é©åˆå¿«å–ï¼

é›–ç„¶ HTTP Range Request ä¹Ÿå¯ä»¥å¿«å–ï¼Œä½†ä¸åŒç€è¦½å™¨ç™¼é€ Range çš„ç­–ç•¥ä¸åŒ

- Range: bytes=0-1
- Range: bytes=0-100
- Range: bytes=0-1000

éƒ½æœƒè¢«è¦–ç‚ºä¸åŒçš„ Cache Keyï¼Œæ‰€ä»¥å¿«å–å‘½ä¸­çš„æ©Ÿç‡å°±å¾ˆä½ï¼Œä¹Ÿå¾ˆé›£é å…ˆæŠŠ Cache æº–å‚™å¥½

## å¦‚ä½•æ”¯å‹•æ…‹åˆ‡æ›ç•«è³ª

å¯¦æ¸¬ä¸åŒç€è¦½å™¨æ­é… HTML åŸç”Ÿçš„ `<video src="playlist.m3u8">`ï¼Œä¸¦ä¸”åœ¨ä¸­é€”ä½¿ç”¨ç€è¦½å™¨å…§å»ºåŠŸèƒ½åˆ‡æ›ç¶²é€Ÿ

- Chrome ä¸æ”¯æ´å‹•æ…‹åˆ‡æ›ç•«è³ªï¼ˆå³ä¾¿åˆ‡åˆ° 3Gï¼Œé‚„æ˜¯ç¹¼çºŒè¼‰å…¥ 1080P çš„ç¬¬äºŒå€‹ chunkï¼‰
  ![chrome-does-not-change-resolution-in-video](../../static/img/chrome-does-not-change-resolution-in-video.jpg)
- Firefox ä¸æ”¯æ´ `<video src="playlist.m3u8">`
  ![firefox-does-not-implement-m3u8](../../static/img/firefox-does-not-implement-m3u8.jpg)
- Safariï¼Œæˆ‘æ‰¾ä¸åˆ° Network Throttling çš„åŠŸèƒ½å•Šï½

çµè«–: æƒ³ä¾è³´ç€è¦½å™¨åŸç”Ÿçš„æ©Ÿåˆ¶ => ä¸å¯é 

## è¦æ€éº¼å•Ÿç”¨ HTTP Live Streaming (HLS)

å¾ˆå¹¸é‹çš„æ˜¯ï¼ŒJavaScript ç”Ÿæ…‹ç³»æœ‰å€‹ [hls.js](https://www.npmjs.com/package/hls.js) å¥—ä»¶ï¼Œå¹«æˆ‘å€‘è™•ç†å¥½ç´°ç¯€äº†

åªéœ€è¦ä»¥ä¸‹ HTML

```html
<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
<video id="video" width="100%" height="100%"></video>
<script>
  if (Hls.isSupported()) {
    const video = document.getElementsByTagName("video")[0];
    const hls = new Hls();
    hls.loadSource("https://cdn.udn.com/vods3/260105182347770/playlist.m3u8");
    hls.attachMedia(video);
  }
</script>
```

å°±å¯ä»¥æ ¹æ“šç¶²é€Ÿï¼Œå‹•æ…‹è¼‰å…¥ä¸åŒç•«è³ªçš„å½±ç‰‡
![hls-js](../../static/img/hls-js.jpg)

<!-- ### #EXT-X-ENDLIST

### #EXT-X-TARGETDURATION

### #EXT-X-BYTERANGE -->

## å°çµ

æœ¬ç¯‡æ–‡ç« ï¼Œæˆ‘å€‘å­¸åˆ°äº†

- HTMLMediaElement: preload
- `<track>`
- HTTP Live Streaming (HLS) + m3u8

å…¶å¯¦é‚„æœ‰å¾ˆå¤šå¯ä»¥æ·±å…¥ï¼ŒåŒ…å«

- ä»˜è²»çš„å½±éŸ³ä¸²æµå¹³å°ï¼ˆNetfilx, HamiVideo...ï¼‰æ˜¯æ€éº¼ä¿è­·å½±ç‰‡è³‡æºåªèƒ½çµ¦è¨‚æˆ¶è§€çœ‹
- HLS ä¸ä¸€å®šè¦æŠŠå½±ç‰‡åˆ‡æˆå¤šå€‹ tsï¼ï¼Ÿ`#EXT-X-BYTERANGE` çš„åŠŸç”¨
- æ·±å…¥ç†è§£ [RFC 8216: HTTP Live Streamimg](https://datatracker.ietf.org/doc/html/rfc8216)
- [hls.js](https://www.npmjs.com/package/hls.js) æ˜¯ç”¨å“ªäº› API å¯¦ç¾çš„

ç¤™æ–¼ç¯‡å¹…é—œä¿‚ï¼Œè‹¥æœªä¾†æœ‰æ©Ÿæœƒå†ä¾†ç ”ç©¶ä¸Šè¿°é€™äº›é¡Œç›®ï½

<!-- ## å¿«å•å¿«ç­”

âœï¸ Question 1: `<video preload="metadata">` å…·é«”æœ‰åŒ…å«å“ªäº› metadataï¼Ÿ

âœï¸ Question 2: m3u8 æ˜¯å½±ç‰‡æ ¼å¼ -->

## åƒè€ƒè³‡æ–™

- https://datatracker.ietf.org/doc/html/rfc8216
- https://html.spec.whatwg.org/multipage/media.html#attr-media-preload
- https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/readyState#htmlmediaelement.have_metadata
